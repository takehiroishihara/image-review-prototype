<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>バナーチェック</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #0f1117;
    color: #e0e0e0;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    user-select: none;
  }

  /* ===== Header ===== */
  .header {
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid #1e2030;
    flex-shrink: 0;
  }

  .header h1 {
    font-size: 13px;
    font-weight: 600;
    line-height: 1.3;
    min-width: 0;
    white-space: nowrap;
  }

  .progress { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
  .progress-bar { flex: 1; height: 5px; background: #1e2030; border-radius: 3px; overflow: hidden; min-width: 40px; }
  .progress-fill { height: 100%; background: #6366f1; border-radius: 3px; transition: width 0.4s ease; }
  .progress-num { font-size: 12px; color: #6b7280; white-space: nowrap; }

  .stats { display: flex; gap: 10px; font-size: 12px; white-space: nowrap; }
  .s-ok { color: #4ade80; }
  .s-ng { color: #fbbf24; }

  /* ===== Phase: Swipe ===== */
  .phase { display: none; flex: 1; flex-direction: column; overflow: hidden; }
  .phase.active { display: flex; }

  .phase-swipe {
    align-items: center; justify-content: center;
    padding: 12px 16px;
    gap: 12px;
  }

  .stack {
    position: relative;
    width: 100%; max-width: 520px;
    height: min(46vh, 380px);
    flex-shrink: 0;
  }

  .swipe-card {
    position: absolute; inset: 0; border-radius: 16px; overflow: hidden;
    background: #1c1f2e; box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    will-change: transform; touch-action: none;
    display: flex; align-items: center; justify-content: center;
  }
  .swipe-card img {
    max-width: 100%; max-height: 100%;
    object-fit: contain; display: block; pointer-events: none;
  }

  .overlay-label {
    position: absolute; top: 20px; padding: 6px 20px; border-radius: 8px;
    font-size: 24px; font-weight: 800; letter-spacing: 2px; opacity: 0; pointer-events: none;
  }
  .label-ok { right: 20px; background: rgba(34,197,94,0.9); color: #fff; transform: rotate(12deg); }
  .label-ng { left: 20px; background: rgba(251,191,36,0.9); color: #fff; transform: rotate(-12deg); }

  .card-counter {
    position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
    background: rgba(0,0,0,0.6); padding: 3px 12px; border-radius: 10px;
    font-size: 11px; color: #aaa; pointer-events: none;
  }

  .actions { display: flex; gap: 20px; align-items: center; flex-shrink: 0; }
  .act-btn {
    width: 56px; height: 56px; border-radius: 50%; border: 2px solid; background: transparent;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all 0.2s; font-size: 22px;
  }
  .act-btn:active { transform: scale(0.9); }
  .btn-undo { width: 42px; height: 42px; border-color: #6b7280; color: #6b7280; font-size: 16px; }
  .btn-undo:hover { background: #6b7280; color: #fff; }
  .act-ng { border-color: #fbbf24; color: #fbbf24; }
  .act-ng:hover { background: #fbbf24; color: #000; }
  .act-ok { border-color: #22c55e; color: #22c55e; }
  .act-ok:hover { background: #22c55e; color: #fff; }

  /* AI Box */
  .ai-box {
    width: 100%; max-width: 520px;
    background: #161930;
    border: 1px solid #2d3060;
    border-radius: 10px;
    padding: 10px 14px;
    display: flex;
    align-items: flex-start;
    gap: 8px;
    flex-shrink: 0;
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.3s, transform 0.3s;
  }

  .ai-box.visible { opacity: 1; transform: translateY(0); }
  .ai-box.hidden { display: none; }

  .ai-icon {
    width: 24px; height: 24px; min-width: 24px;
    border-radius: 6px;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; font-weight: 700; color: #fff;
  }

  .ai-body { font-size: 12px; line-height: 1.5; color: #b0b4d0; }
  .ai-status-ok { color: #4ade80; font-weight: 600; }
  .ai-status-ng { color: #fbbf24; font-weight: 600; }

  .hint {
    font-size: 10px; color: #4b5563; display: flex; gap: 12px; flex-shrink: 0;
  }
  .hint kbd { background: #1e2030; padding: 1px 5px; border-radius: 3px; color: #9ca3af; }

  @keyframes flyRight { to { transform: translateX(150%) rotate(20deg); opacity: 0; } }
  @keyframes flyLeft  { to { transform: translateX(-150%) rotate(-20deg); opacity: 0; } }
  @keyframes flyUp    { to { transform: translateY(-120%) scale(0.9); opacity: 0; } }
  .fly-right { animation: flyRight 0.35s ease forwards; }
  .fly-left  { animation: flyLeft  0.35s ease forwards; }
  .fly-up    { animation: flyUp   0.35s ease forwards; }

  /* ===== Phase: Transition ===== */
  .phase-transition {
    align-items: center; justify-content: center;
    text-align: center; padding: 40px 24px;
  }

  .transition-icon {
    font-size: 40px; margin-bottom: 16px;
  }

  .phase-transition h2 {
    font-size: 20px; margin-bottom: 8px;
  }

  .phase-transition p {
    font-size: 14px; color: #9ca3af; line-height: 1.6;
    margin-bottom: 24px;
  }

  .transition-btn {
    padding: 12px 40px; border: none; border-radius: 10px;
    background: #6366f1; color: #fff; font-size: 14px; font-weight: 600;
    cursor: pointer;
  }
  .transition-btn:hover { background: #4f46e5; }

  /* ===== Phase: NG Review (1-by-1) ===== */
  .phase-review {
    align-items: center;
    justify-content: center;
    padding: 12px 16px;
    gap: 10px;
  }

  .review-card-area {
    position: relative;
    width: 100%; max-width: 520px;
    flex-shrink: 0;
  }

  .review-card {
    background: #1c1f2e;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    will-change: transform;
  }

  .review-card-img {
    width: 100%;
    max-height: min(28vh, 220px);
    object-fit: contain;
    display: block;
    background: #111;
  }

  .review-card-body {
    padding: 12px 14px;
    display: flex; flex-direction: column; gap: 8px;
  }

  .review-card-label {
    font-size: 12px; color: #fbbf24; font-weight: 600;
  }

  .review-card-counter {
    font-size: 11px; color: #6b7280;
  }

  .review-tags { display: flex; flex-wrap: wrap; gap: 6px; }

  .r-tag {
    padding: 6px 12px; border-radius: 6px; border: 1px solid #2a2d3a;
    background: transparent; color: #d1d5db; font-size: 12px;
    cursor: pointer; transition: all 0.15s;
  }
  .r-tag:hover { border-color: #fbbf24; color: #fcd34d; }
  .r-tag.active { background: #d97706; border-color: #d97706; color: #fff; }

  .r-detail {
    width: 100%;
    background: #141625;
    border: 1px solid #2a2d3a;
    border-radius: 8px;
    padding: 8px 10px;
    color: #e0e0e0;
    font-size: 13px;
    font-family: inherit;
    resize: vertical;
    min-height: 56px;
    display: none;
    line-height: 1.5;
  }
  .r-detail.show { display: block; }
  .r-detail::placeholder { color: #4b5563; }
  .r-detail:focus { outline: none; border-color: #fbbf24; }

  .r-ditto {
    padding: 6px 12px; border-radius: 6px;
    border: 1px dashed #6366f1;
    background: transparent; color: #a5b4fc; font-size: 12px;
    cursor: pointer; transition: all 0.15s;
    align-self: flex-start;
  }
  .r-ditto:hover { background: #6366f1; color: #fff; border-style: solid; }

  .review-submit-row {
    width: 100%; max-width: 520px;
    display: flex; gap: 10px;
    flex-shrink: 0;
  }

  .review-submit {
    flex: 1;
    padding: 12px; border: none; border-radius: 10px;
    background: #d97706; color: #fff; font-size: 14px; font-weight: 600;
    cursor: pointer; transition: background 0.15s;
  }
  .review-submit:hover { background: #b45309; }

  .review-skip {
    padding: 12px 20px; border: 1px solid #2a2d3a; border-radius: 10px;
    background: transparent; color: #9ca3af; font-size: 13px;
    cursor: pointer; transition: all 0.15s;
  }
  .review-skip:hover { border-color: #6b7280; color: #d1d5db; }

  /* ===== Phase: Done ===== */
  .phase-done {
    align-items: center; justify-content: center;
    text-align: center; padding: 40px 24px;
  }

  .done-icon { font-size: 48px; margin-bottom: 16px; }

  .phase-done h2 { font-size: 20px; margin-bottom: 8px; }

  .phase-done p {
    font-size: 14px; color: #9ca3af; line-height: 1.6;
    margin-bottom: 24px;
  }

  .done-results { display: flex; gap: 24px; justify-content: center; font-size: 18px; }
</style>
</head>
<body>

<div class="header">
  <h1>バナー<br>チェック</h1>
  <div class="progress">
    <div class="progress-bar"><div class="progress-fill" id="pFill"></div></div>
    <span class="progress-num" id="pText">0/0</span>
  </div>
  <div class="stats">
    <span class="s-ok" id="sOk">OK: 0</span>
    <span class="s-ng" id="sNg">修正: 0</span>
  </div>
</div>

<!-- Phase 1: Swipe -->
<div class="phase phase-swipe active" id="phaseSwipe">
  <div class="stack" id="stack"></div>
  <div class="actions">
    <button class="act-btn btn-undo" id="btnUndo" title="戻す">↩</button>
    <button class="act-btn act-ng" id="btnNg" title="修正">✕</button>
    <button class="act-btn act-ok" id="btnOk" title="OK">✓</button>
  </div>
  <div class="ai-box hidden" id="aiBox">
    <div class="ai-icon">AI</div>
    <div class="ai-body" id="aiBody"></div>
  </div>
  <div class="hint" id="hintBar">
    <span><kbd>→</kbd> OK</span>
    <span><kbd>←</kbd> 修正</span>
    <span><kbd>Z</kbd> 戻す</span>
  </div>
</div>

<!-- Phase 1.5: Transition -->
<div class="phase phase-transition" id="phaseTransition">
  <div class="transition-icon">&#x1F389;</div>
  <h2>ありがとうございます！</h2>
  <p>続いて修正バナーの<br>理由の詳細をお願いします</p>
  <button class="transition-btn" id="transitionBtn">修正理由を入力する</button>
</div>

<!-- Phase 2: NG Review (1-by-1) -->
<div class="phase phase-review" id="phaseReview">
  <div class="review-card-area" id="reviewCardArea"></div>
  <div class="review-submit-row">
    <button class="review-skip" id="reviewSkip">スキップ</button>
    <button class="review-submit" id="reviewSubmit">確定</button>
  </div>
</div>

<!-- Phase 3: Done -->
<div class="phase phase-done" id="phaseDone">
  <div class="done-icon">&#x2728;</div>
  <h2>ありがとうございました</h2>
  <p>お疲れ様でした！</p>
  <div class="done-results">
    <span class="s-ok" id="finalOk"></span>
    <span class="s-ng" id="finalNg"></span>
  </div>
</div>

<script>
const NG_CATEGORIES = [
  { key: 'ng_word',    label: 'ワード修正', ph: '例: 便秘はNG、宿便に変更' },
  { key: 'add_note',   label: '注釈追加',     ph: '例: ※画像はイメージ' },
  { key: 'del_note',   label: '注釈削除',     ph: '例: 全ての注釈を削除' },
  { key: 'fix_text',   label: 'テキスト修正', ph: '例: 1杯50円→99円に修正' },
  { key: 'del_elem',   label: '要素削除',     ph: '例: 「※パッケージは〜」を削除' },
  { key: 'expression', label: '表現修正',     ph: '例: 効果を断定する表現は修正' },
  { key: 'other',      label: 'その他',       ph: '詳細を記入' },
];

const BANNERS = [
  { id: 1,  group: 'A', img: 'https://picsum.photos/seed/cosmA1/1200/628' },
  { id: 2,  group: 'B', img: 'https://picsum.photos/seed/techB1/1200/628' },
  { id: 3,  group: 'A', img: 'https://picsum.photos/seed/cosmA2/1200/628' },
  { id: 4,  group: 'C', img: 'https://picsum.photos/seed/foodC1/1200/628' },
  { id: 5,  group: 'D', img: 'https://picsum.photos/seed/fashD1/1200/628' },
  { id: 6,  group: 'B', img: 'https://picsum.photos/seed/techB2/1200/628' },
  { id: 7,  group: 'A', img: 'https://picsum.photos/seed/cosmA3/1080/1080' },
  { id: 8,  group: 'E', img: 'https://picsum.photos/seed/travelE1/1080/1080' },
  { id: 9,  group: 'C', img: 'https://picsum.photos/seed/foodC2/1080/1080' },
  { id: 10, group: 'D', img: 'https://picsum.photos/seed/fashD2/1080/1080' },
  { id: 11, group: 'F', img: 'https://picsum.photos/seed/sportF1/1080/1080' },
  { id: 12, group: 'B', img: 'https://picsum.photos/seed/techB3/1080/1080' },
  { id: 13, group: 'E', img: 'https://picsum.photos/seed/travelE2/1080/1920' },
  { id: 14, group: 'C', img: 'https://picsum.photos/seed/foodC3/1080/1920' },
  { id: 15, group: 'F', img: 'https://picsum.photos/seed/sportF2/1080/1920' },
  { id: 16, group: 'D', img: 'https://picsum.photos/seed/fashD3/1080/1920' },
  { id: 17, group: 'A', img: 'https://picsum.photos/seed/cosmA4/1080/1920' },
  { id: 18, group: 'E', img: 'https://picsum.photos/seed/travelE3/1080/1920' },
  { id: 19, group: 'F', img: 'https://picsum.photos/seed/sportF3/1200/628' },
  { id: 20, group: 'B', img: 'https://picsum.photos/seed/techB4/1200/628' },
  { id: 21, group: 'G', img: 'https://picsum.photos/seed/intG1/1080/1080' },
  { id: 22, group: 'G', img: 'https://picsum.photos/seed/intG2/1080/1080' },
  { id: 23, group: 'G', img: 'https://picsum.photos/seed/intG3/1080/1920' },
  { id: 24, group: 'H', img: 'https://picsum.photos/seed/luxH1/1200/628' },
];

// State
let items = BANNERS.map(b => ({ ...b, status: 'pending', reasons: [], detail: '' }));
let current = 0;
let historyStack = [];
let okCount = 0, ngCount = 0;
let dragging = false, startX = 0, startY = 0, dx = 0;
let cardEl = null;

// NG review state
let ngItems = [];
let ngCurrent = 0;
let lastNgReasons = [];
let lastNgDetail = '';

// ===== Utility =====
function showPhase(id) {
  document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ===== Similar info =====
function getSimilarJudged(item) {
  return items.filter(i => i.id !== item.id && i.group === item.group && i.status !== 'pending');
}

function updateAiBox() {
  const box = document.getElementById('aiBox');
  const body = document.getElementById('aiBody');
  if (current >= items.length) { box.classList.add('hidden'); box.classList.remove('visible'); return; }

  const judged = getSimilarJudged(items[current]);
  if (judged.length === 0) { box.classList.add('hidden'); box.classList.remove('visible'); return; }

  box.classList.remove('hidden');
  const okN = judged.filter(i => i.status === 'ok').length;
  const ngN = judged.filter(i => i.status === 'ng').length;
  let msgs = [];
  if (okN) msgs.push(`類似バナー${okN > 1 ? okN + '件' : ''}を<span class="ai-status-ok">OK</span>にしました`);
  if (ngN) msgs.push(`類似バナー${ngN > 1 ? ngN + '件' : ''}を<span class="ai-status-ng">修正</span>にしました`);
  body.innerHTML = msgs.join('<br>');
  requestAnimationFrame(() => box.classList.add('visible'));
}

// ===== Swipe: Build stack =====
function buildStack() {
  const stack = document.getElementById('stack');
  stack.innerHTML = '';
  if (current >= items.length) { enterTransition(); return; }

  for (let i = Math.min(current + 2, items.length - 1); i >= current; i--) {
    const offset = i - current;
    const item = items[i];
    const card = document.createElement('div');
    card.className = 'swipe-card';
    card.style.zIndex = 10 - offset;
    card.style.transform = `scale(${1 - offset * 0.04}) translateY(${offset * 8}px)`;
    card.style.opacity = offset === 0 ? 1 : 0.6;
    card.innerHTML = `
      <img src="${item.img}" alt="">
      <div class="overlay-label label-ok">OK</div>
      <div class="overlay-label label-ng">修正</div>
      <div class="card-counter">${i + 1} / ${items.length}</div>
    `;
    if (offset === 0) { card.addEventListener('pointerdown', onPointerDown); cardEl = card; }
    stack.appendChild(card);
  }
  updateAiBox();
}

function updateUI() {
  const checked = okCount + ngCount;
  document.getElementById('pFill').style.width = `${(checked / items.length) * 100}%`;
  document.getElementById('pText').textContent = `${checked}/${items.length}`;
  document.getElementById('sOk').textContent = `OK: ${okCount}`;
  document.getElementById('sNg').textContent = `修正: ${ngCount}`;
}

// ===== Swipe: Drag =====
function onPointerDown(e) {
  if (current >= items.length) return;
  dragging = true; startX = e.clientX; startY = e.clientY; dx = 0;
  cardEl.style.transition = 'none';
  cardEl.setPointerCapture(e.pointerId);
  cardEl.addEventListener('pointermove', onPointerMove);
  cardEl.addEventListener('pointerup', onPointerUp);
}

function onPointerMove(e) {
  if (!dragging) return;
  dx = e.clientX - startX;
  const dy = (e.clientY - startY) * 0.3;
  cardEl.style.transform = `translate(${dx}px, ${dy}px) rotate(${dx * 0.06}deg)`;
  const t = 60;
  cardEl.querySelector('.label-ok').style.opacity = dx > t ? Math.min((dx - t) / 80, 1) : 0;
  cardEl.querySelector('.label-ng').style.opacity = dx < -t ? Math.min((-dx - t) / 80, 1) : 0;
}

function onPointerUp(e) {
  if (!dragging) return;
  dragging = false;
  cardEl.removeEventListener('pointermove', onPointerMove);
  cardEl.removeEventListener('pointerup', onPointerUp);
  if (dx > 100) doJudge('ok');
  else if (dx < -100) doJudge('ng');
  else {
    cardEl.style.transition = 'transform 0.3s ease';
    cardEl.style.transform = 'scale(1) translateY(0)';
    cardEl.querySelector('.label-ok').style.opacity = 0;
    cardEl.querySelector('.label-ng').style.opacity = 0;
  }
}

function doJudge(status) {
  if (current >= items.length) return;
  const item = items[current];
  cardEl.style.transition = 'none';
  cardEl.classList.add(status === 'ok' ? 'fly-right' : 'fly-left');
  historyStack.push({ index: current, prevStatus: item.status });
  item.status = status;
  if (status === 'ok') okCount++; else ngCount++;
  current++;
  updateUI();
  setTimeout(() => buildStack(), 320);
}

function undo() {
  if (historyStack.length === 0) return;
  const entry = historyStack.pop();
  const item = items[entry.index];
  if (item.status === 'ok') okCount--; else if (item.status === 'ng') ngCount--;
  item.status = 'pending'; item.reasons = []; item.detail = '';
  current = entry.index;
  updateUI(); buildStack();
}

// ===== Transition =====
function enterTransition() {
  ngItems = items.filter(i => i.status === 'ng');
  if (ngItems.length === 0) { enterDone(); return; }
  showPhase('phaseTransition');
}

document.getElementById('transitionBtn').addEventListener('click', () => {
  ngCurrent = 0;
  showPhase('phaseReview');
  buildReviewCard();
});

// ===== NG Review: 1-by-1 =====
function buildReviewCard() {
  const area = document.getElementById('reviewCardArea');
  if (ngCurrent >= ngItems.length) { enterDone(); return; }

  const item = ngItems[ngCurrent];
  const card = document.createElement('div');
  card.className = 'review-card';
  card.id = 'currentReviewCard';

  const showDitto = ngCurrent > 0 && lastNgReasons.length > 0;

  card.innerHTML = `
    <img class="review-card-img" src="${item.img}" alt="">
    <div class="review-card-body">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <span class="review-card-label">修正 — #${item.id}</span>
        <span class="review-card-counter">${ngCurrent + 1} / ${ngItems.length}</span>
      </div>
      ${showDitto ? `<button class="r-ditto" id="dittoBtn">↑ 前と同じ理由を適用</button>` : ''}
      <div class="review-tags" id="reviewTags">
        ${NG_CATEGORIES.map(c =>
          `<button class="r-tag" data-cat="${c.key}">${c.label}</button>`
        ).join('')}
      </div>
      <textarea class="r-detail" id="reviewDetail" placeholder="修正理由の詳細を記入..."></textarea>
    </div>
  `;

  area.innerHTML = '';
  area.appendChild(card);

  // Tag handlers
  card.querySelectorAll('.r-tag').forEach(btn => {
    btn.addEventListener('click', () => {
      btn.classList.toggle('active');
      const textarea = card.querySelector('.r-detail');
      const hasActive = card.querySelectorAll('.r-tag.active').length > 0;
      textarea.classList.toggle('show', hasActive);
      if (btn.classList.contains('active')) {
        const cat = NG_CATEGORIES.find(c => c.key === btn.dataset.cat);
        if (cat) textarea.placeholder = cat.ph;
      }
    });
  });

  // Ditto handler
  const dittoBtn = card.querySelector('#dittoBtn');
  if (dittoBtn) {
    dittoBtn.addEventListener('click', () => {
      // Apply previous categories
      card.querySelectorAll('.r-tag').forEach(t => {
        t.classList.toggle('active', lastNgReasons.includes(t.dataset.cat));
      });
      // Apply previous detail
      const textarea = card.querySelector('.r-detail');
      textarea.value = lastNgDetail;
      textarea.classList.toggle('show', lastNgReasons.length > 0);
      // Feedback
      dittoBtn.textContent = '適用しました';
      dittoBtn.style.borderColor = '#22c55e';
      dittoBtn.style.color = '#4ade80';
    });
  }
}

function submitReviewCard(skip) {
  const item = ngItems[ngCurrent];
  const card = document.getElementById('currentReviewCard');

  if (!skip && card) {
    const activeCats = [...card.querySelectorAll('.r-tag.active')].map(t => t.dataset.cat);
    const detail = card.querySelector('.r-detail').value.trim();
    item.reasons = activeCats.map(k => {
      const c = NG_CATEGORIES.find(c => c.key === k);
      return c ? c.label : k;
    });
    item.detail = detail;
    // Remember for ditto
    lastNgReasons = activeCats;
    lastNgDetail = detail;
  }

  // Fly away animation
  if (card) {
    card.classList.add('fly-up');
  }

  ngCurrent++;

  // Update progress for review phase
  const total = items.length;
  const reviewDone = ngItems.filter((_, i) => i < ngCurrent).length;
  const baseChecked = okCount + ngCount;
  document.getElementById('pFill').style.width = `${((baseChecked + reviewDone * 0) / total) * 100}%`;

  setTimeout(() => buildReviewCard(), 320);
}

document.getElementById('reviewSubmit').addEventListener('click', () => submitReviewCard(false));
document.getElementById('reviewSkip').addEventListener('click', () => submitReviewCard(true));

// ===== Done =====
function enterDone() {
  showPhase('phaseDone');
  document.getElementById('finalOk').textContent = `OK: ${okCount}`;
  document.getElementById('finalNg').textContent = `修正: ${ngCount}`;

  console.log('=== Results ===');
  items.forEach(i => {
    const cats = i.reasons.length ? ` [${i.reasons.join(', ')}]` : '';
    const d = i.detail ? ` → ${i.detail}` : '';
    console.log(`#${i.id} ${i.status.toUpperCase()}${cats}${d}`);
  });
}

// ===== Button clicks =====
document.getElementById('btnOk').addEventListener('click', () => doJudge('ok'));
document.getElementById('btnNg').addEventListener('click', () => doJudge('ng'));
document.getElementById('btnUndo').addEventListener('click', undo);

// ===== Keyboard =====
document.addEventListener('keydown', (e) => {
  if (document.getElementById('phaseSwipe').classList.contains('active')) {
    if (e.key === 'ArrowRight') { e.preventDefault(); doJudge('ok'); }
    if (e.key === 'ArrowLeft')  { e.preventDefault(); doJudge('ng'); }
    if (e.key === 'z' || e.key === 'Z') { e.preventDefault(); undo(); }
  }
  if (document.getElementById('phaseReview').classList.contains('active')) {
    if (e.key === 'Enter' && !e.target.matches('textarea')) { e.preventDefault(); submitReviewCard(false); }
  }
});

// ===== Init =====
buildStack();
updateUI();
</script>
</body>
</html>
